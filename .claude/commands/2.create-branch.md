#!/usr/bin/env bash

# Create a new branch based on the plan from step 1
# Usage: /2.create-branch

# Get the issue number from the plan file
ISSUE_NUMBER=$(grep -E "^# Issue #[0-9]+" 1.plan-github-issue.md | head -1 | grep -oE "#[0-9]+" | tr -d '#')

if [ -z "$ISSUE_NUMBER" ]; then
    echo "Error: Could not find issue number in 1.plan-github-issue.md"
    exit 1
fi

# Create branch name from issue title
ISSUE_TITLE=$(gh issue view $ISSUE_NUMBER --json title -q .title)
BRANCH_NAME="feature/issue-${ISSUE_NUMBER}-$(echo "$ISSUE_TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd '[:alnum:]-' | cut -c1-50)"

echo "Creating branch: $BRANCH_NAME"

# Fetch latest changes
git fetch origin

# Create and checkout new branch from main
git checkout -b "$BRANCH_NAME" origin/main

echo "Successfully created and switched to branch: $BRANCH_NAME"
echo "You can now proceed with implementing the changes from the plan."
